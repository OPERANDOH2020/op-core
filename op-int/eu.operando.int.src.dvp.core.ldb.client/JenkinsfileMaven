#!groovy
node {
   def mvnHome 
   stage('Preparation') { // for display purposes
	  // Get the Maven tool.
	  // ** NOTE: This 'M3' Maven tool must be configured
	  // **       in the global configuration.
	  mvnHome = tool 'Maven 3.3.9 colocated'
   }
   stage ('Source Collection'){
	   checkout([$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'sources'], [$class: 'SparseCheckoutPaths', sparseCheckoutPaths: [[path: 'op-core-logdb/eu.operando.core.ldb.client']]]], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'a35cd88c-d990-4446-922b-b19d0640fd50', url: 'https://github.com/OPERANDOH2020/op-core.git']]])
   }
   stage ('Maven Install'){
	   sh "'${mvnHome}/bin/mvn' install -f sources/op-core-logdb/eu.operando.core.ldb.client/pom.xml"
   }
   post {
       failure {
		  emailext (
		      subject: "FAILED: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]'",
		      body: """<p>FAILED: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]':</p>
		        <p>Check console output at &QUOT;<a href='${env.BUILD_URL}'>${env.JOB_NAME} [${env.BUILD_NUMBER}]</a>&QUOT;</p>""",
		      recipientProviders: [[$class: 'DevelopersRecipientProvider']]
		    )
	   }
   }
}
